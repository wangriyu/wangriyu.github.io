<!DOCTYPE html><html lang="zh-Hans"><head><!--[if IE]><style>body{display:none;}</style><script>alert('IE浏览器下无法展示效果，请更换浏览器！');var headNode=document.getElementsByTagName('head')[0];var refresh=document.createElement('meta');refresh.setAttribute('http-equiv','Refresh');refresh.setAttribute('Content','0; url=http://outdatedbrowser.com/');headNode.appendChild(refresh);</script><![endif]--><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="鱼乐"><meta name="shenma-site-verification" content="cd3048846de29809263b063b8e307624_1527169631"><meta name="360-site-verification" content="2d95e707197a9f8b2936ef16f299d4ee"><meta name="sogou_site_verification" content="ZdMIkaFR8c"><meta name="description" content="输入输出（I/O）是主存和外部设备设备（磁盘驱动器、终端、网络等）之间复制数据的过程。"><meta name="keywords" content="深入理解计算机"><meta property="og:type" content="article"><meta property="og:title" content="系统 I&#x2F;O"><meta property="og:url" content="https://blog.wangriyu.wang/2017/08-SystemIO.html"><meta property="og:site_name" content="Wangriyu’s Blog"><meta property="og:description" content="输入输出（I/O）是主存和外部设备设备（磁盘驱动器、终端、网络等）之间复制数据的过程。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://blog.wangriyu.wang/img/loading.gif"><meta property="og:updated_time" content="2018-07-29T04:27:21.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="系统 I&#x2F;O"><meta name="twitter:description" content="输入输出（I/O）是主存和外部设备设备（磁盘驱动器、终端、网络等）之间复制数据的过程。"><meta name="twitter:image" content="https://blog.wangriyu.wang/img/loading.gif"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="shortcut icon" href="/favicon.ico"><link href="//src.wangriyu.wang/lib/fancybox/jquery.fancybox.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/style.css"><title>系统 I/O | Wangriyu’s Blog</title><script src="//src.wangriyu.wang/lib/jquery/jquery.min.js"></script><link href="//src.wangriyu.wang/lib/font-awesome/css/font-awesome.min.css" rel="stylesheet"><script src="//src.wangriyu.wang/lib/aos/aos.js"></script><script>var yiliaConfig={fancybox:!0,isHome:!1,isPost:!0,isArchive:!1,isTag:!1,isCategory:!1,fancybox_js:"//src.wangriyu.wang/lib/fancybox/jquery.fancybox.min.js",search:!0}</script><script>yiliaConfig.jquery_ui=[!1]</script><script>yiliaConfig.rootUrl="/"</script><link rel="stylesheet" href="/css/prism-a11y-dark.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism-a11y-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head></html><body><div id="container"><div class="left-col"><div class="backImg"><img src="//src.wangriyu.wang/images/blog/yule.jpg" width="312" height="330px"></div><div class="intrude-less"><header id="header" class="inner"><a href="/" class="profilepic"><img src="//src.wangriyu.wang/images/blog/avatar.jpg"></a><hgroup><h1 class="header-author"><a href="/">鱼乐</a></h1></hgroup><p class="header-subtitle">子非鱼，安知鱼之乐也！</p><form id="search-form"><input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false"> <i class="fa fa-times" onclick="resetSearch()"></i></form><div id="local-search-result"></div><p class="no-result">No results found <i class="fa fa-spinner fa-pulse"></i></p><div id="switch-btn" class="switch-btn"><div class="icon"><div class="icon-ctn"><div class="icon-wrap icon-house" data-idx="0"><div class="birdhouse"></div><div class="birdhouse_holes"></div></div><div class="icon-wrap icon-ribbon hide" data-idx="1"><div class="ribbon"></div></div><div class="icon-wrap icon-link hide" data-idx="2"><div class="loopback_l"></div><div class="loopback_r"></div></div><div class="icon-wrap icon-me hide" data-idx="3"><div class="user"></div><div class="shoulder"></div></div></div></div><div class="tips-box hide"><div class="tips-arrow"></div><ul class="tips-inner"><li>菜单</li><li>标签</li><li>友情链接</li><li>目标</li></ul></div></div><div id="switch-area" class="switch-area"><div class="switch-wrap"><section class="switch-part switch-part1"><nav class="header-menu"><ul><li><a href="//home.wangriyu.wang">主页</a></li><li><a href="/archives/">归档</a></li><li><a href="/pages/waterFallAlbum">相册</a></li><li><a href="/about/">简历</a></li><li><a href="/tags/">标签云</a></li></ul></nav><nav class="header-nav"><ul class="social"><a class="fa Email" href="mailto:wangriyu1997@gmail.com" title="Email"></a> <a class="fa GitHub" href="https://github.com/wangriyu" title="GitHub"></a> <a class="fa RSS" href="/atom.xml" title="RSS"></a> <a class="fa 知乎" href="https://www.zhihu.com/people/clownduo/activities" title="知乎"></a> <a class="fa 网易云音乐" href="https://music.163.com/#/user/home?id=102244407" title="网易云音乐"></a> <a class="fa 掘金" href="https://juejin.im/user/58c3744bda2f605609683d66" title="掘金"></a> <a class="fa Facebook" href="https://www.facebook.com/riyu.wang.7" title="Facebook"></a> <a class="fa Twitter" href="https://twitter.com/wangriyu" title="Twitter"></a></ul><ul class="social"><div style="position:absolute;top:95%;left:50%;margin-left:-28px"><p style="display:block"><a class="donateIcon" href="javascript:void(0)" onmouseout='var qr=document.getElementById("donate");qr.style.display="none"' onmouseenter='var qr=document.getElementById("donate");qr.style.display="block"'>赏</a></p><div id="donate"><img id="multipay" src="//src.wangriyu.wang/images/blog/multipay.png" width="250px" alt="鱼乐 Multipay"><div class="triangle"></div></div></div></ul></nav></section><section class="switch-part switch-part2"><div class="widget tagcloud" id="js-tagcloud"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Aplayer/">Aplayer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CGO/">CGO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Copy/">Copy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/">ELK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Log/">Log</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac-存储扩展/">Mac 存储扩展</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UEFI-GPT/">UEFI&GPT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Yelee/">Yelee</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dart/">dart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftp/">ftp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go-源码/">go 源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http-扩展阅读/">http 扩展阅读</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javaScript/">javaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libc/">libc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/masm/">masm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nextcloud/">nextcloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rEFInd-引导美化/">rEFInd 引导美化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/root/">root</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/win10-Ubuntu-双系统/">win10&Ubuntu 双系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/三阶段提交/">三阶段提交</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/两阶段提交/">两阶段提交</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/个人网盘/">个人网盘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分享/">分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式理论/">分布式理论</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/刷机/">刷机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/哈希/">哈希</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/应用/">应用</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技巧/">技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/插件/">插件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/树/">树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浏览器/">浏览器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浏览器本地存储/">浏览器本地存储</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深入理解计算机/">深入理解计算机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络/">网络</a></li></ul></div></section><section class="switch-part switch-part3"><div id="js-friends"><a class="main-nav-link switch-friends-link" href="https://github.com/TechCatsLab">TechCatsLab</a> <a class="main-nav-link switch-friends-link" href="https://yangchenglong11.github.io">YangChengLong</a> <a class="main-nav-link switch-friends-link" href="https://jsharkc.github.io">LiuJiaChang</a> <a class="main-nav-link switch-friends-link" href="http://blog.yusank.space">YusanKurban</a> <a class="main-nav-link switch-friends-link" href="https://blog.lizebang.top">Lizebang</a> <a class="main-nav-link switch-friends-link" href="https://github.com/sunanxiang">SunAnXiang</a> <a class="main-nav-link switch-friends-link" href="https://github.com/DoubleWoodH">LinHao</a> <a class="main-nav-link switch-friends-link" href="https://blog.littlechao.top">ShiChao</a> <a class="main-nav-link switch-friends-link" href="https://github.com/Txiaozhe">TangXiaoJi</a> <a class="main-nav-link switch-friends-link" href="https://github.com/LLLeon">JiaChenHui</a></div></section><section class="switch-part switch-part4"><div id="js-aboutme">不悲不喜，不卑不亢，努力成为一个更好的程序猿！</div></section></div></div></header></div></div><div class="hide-left-col" title="隐藏侧栏"><i class="fa fa-angle-double-left"></i></div><div class="mid-col"><nav id="mobile-nav"><div class="overlay"><div class="slider-trigger"></div><h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">鱼乐</a></h1></div><div class="intrude-less"><header id="header" class="inner"><a href="/" class="profilepic"><img src="//src.wangriyu.wang/images/blog/avatar.jpg"></a><hgroup><h1 class="header-author"><a href="/" title="回到主页">鱼乐</a></h1></hgroup><p class="header-subtitle">子非鱼，安知鱼之乐也！</p><nav class="header-menu"><ul><li><a href="//home.wangriyu.wang">主页</a></li><li><a href="/archives/">归档</a></li><li><a href="/pages/waterFallAlbum">相册</a></li><li><a href="/about/">简历</a></li><li><a href="/tags/">标签云</a></li><div class="clearfix"></div></ul></nav><nav class="header-nav"><ul class="social"><a class="fa Email" target="_blank" href="mailto:wangriyu1997@gmail.com" title="Email"></a> <a class="fa GitHub" target="_blank" href="https://github.com/wangriyu" title="GitHub"></a> <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a> <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/clownduo/activities" title="知乎"></a> <a class="fa 网易云音乐" target="_blank" href="https://music.163.com/#/user/home?id=102244407" title="网易云音乐"></a> <a class="fa 掘金" target="_blank" href="https://juejin.im/user/58c3744bda2f605609683d66" title="掘金"></a> <a class="fa Facebook" target="_blank" href="https://www.facebook.com/riyu.wang.7" title="Facebook"></a> <a class="fa Twitter" target="_blank" href="https://twitter.com/wangriyu" title="Twitter"></a></ul></nav></header></div><link class="menu-list" tags="标签" friends="友情链接" about="目标"></nav><div class="body-wrap"><article id="post-SystemIO" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2017/08-SystemIO.html" class="article-date"><time datetime="2017-08-04T16:00:00.000Z" itemprop="datePublished">2017-08-05</time></a></div><div class="article-inner"><input type="hidden" class="isFancy"><header class="article-header"><h1 class="article-title" itemprop="name">系统 I/O</h1></header><div class="article-info article-info-post"><div class="article-category tagcloud"><a class="article-category-link" href="/categories/READ/">READ</a></div><div class="article-tag tagcloud" style="display:flex;flex-wrap:wrap"><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/深入理解计算机/">深入理解计算机</a></li></ul><span class="post-count">总字数2,636</span> <span class="post-count">预计阅读11分钟</span></div><div class="clearfix"></div></div><div class="article-entry" itemprop="articleBody"><p><strong>输入输出（I/O）是主存和外部设备设备（磁盘驱动器、终端、网络等）之间复制数据的过程。</strong></p><a id="more"></a><h2 id="Unix-I-O-是系统底层数据操作"><a href="#Unix-I-O-是系统底层数据操作" class="headerlink" title="Unix I/O 是系统底层数据操作"></a>Unix I/O 是系统底层数据操作</h2><p><a class="fancy-ctn" href="https://src.wangriyu.wang/images/blog/io/IO.png" title="img" data-fancybox="images" data-caption="IO.png"><img data-original="https://src.wangriyu.wang/images/blog/io/IO.png" src="/img/loading.gif" title="img" alt="img"></a></p><p>open() 和 close() 来打开和关闭文件，使用 read() 和 write() 来读写文件，或者利用 lseek() 来设定读取的偏移量</p><ul><li>文件类型：</li></ul><ol><li>普通文件：包含任意数据</li><li>目录：相关一组文件的索引</li><li>套接字 Socket：和另一台机器上的进程通信的类型</li></ol><p>目录包含一个链接 (link) 数组，并且每个目录至少包含两条记录：<br>./ 当前目录<br>../ 上一层目录</p><p>相对路径和绝对路径</p><ul><li><p>打开文件</p><p>open 函数（返回的文件描述符一定是最小的且没有被用过的数值）</p></li></ul><pre class="line-numbers language-clike"><code class="language-clike">int <span class="token function">open</span><span class="token punctuation">(</span>const char <span class="token operator">*</span>pathname<span class="token punctuation">,</span> int flags<span class="token punctuation">,</span> mode_t mode<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// flags 用于指定文件的打开 / 创建模式, 第三个参数仅当创建新文件时才使用，用于指定文件的访问权限位（access permission bits）</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>flags:<br>O_RDONLY 只读模式<br>O_WRONLY 只写模式<br>O_RDWR 读写模式<br>. . .</p><p>modes:<br>S_IRWXU00700 权限，代表该文件所有者具有可读、可写及可执行的权限。<br>S_IRUSR 或 S_IREAD，00400 权限，代表该文件所有者具有可读取的权限。<br>S_IWUSR 或 S_IWRITE，00200 权限，代表该文件所有者具有可写入的权限。<br>S_IXUSR 或 S_IEXEC，00100 权限，代表该文件所有者具有可执行的权限<br>. . .</p><pre class="line-numbers language-clike"><code class="language-clike">int fd<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 文件描述符</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/etc/hosts"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 返回值等于 -1 则说明发生了错误</span>
<span class="token punctuation">{</span>
    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>关闭文件<br>close 函数用于关闭已打开的文件, 关闭一个已关闭的描述符会出错</li></ul><pre class="line-numbers language-clike"><code class="language-clike">int <span class="token function">close</span><span class="token punctuation">(</span>int fd<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-clike"><code class="language-clike">int fd<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// 文件描述符</span>
int retval<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 返回值</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>retval <span class="token operator">=</span> <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>读取文件<br>实际上就是把文件中对应的字节复制到内存中</li></ul><pre class="line-numbers language-clike"><code class="language-clike">ssize_t <span class="token function">read</span><span class="token punctuation">(</span>int fd<span class="token punctuation">,</span> void <span class="token operator">*</span>buf<span class="token punctuation">,</span> size_t count<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 成功执行时，返回所读取的数据量，如果读到文件的末尾 EOF 则返回 0。失败的时候返回 - 1</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>buf: 所要读取到的数据的内存缓冲<br>count：需要读取的数据量</p><pre class="line-numbers language-clike"><code class="language-clike">char buf<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
int fd<span class="token punctuation">;</span>
int nbytes<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 打开文件描述符，并从中读取 512 字节的数据</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>nbytes <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>写入文件</li></ul><pre class="line-numbers language-clike"><code class="language-clike">ssize_t <span class="token function">write</span><span class="token punctuation">(</span>int fd<span class="token punctuation">,</span> const void <span class="token operator">*</span>buf<span class="token punctuation">,</span> size_t nbytes<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// write 函数将 buf 中的 nbytes 字节内容写入文件描述符 fd. 成功时返回写的字节数. 失败时返回 - 1</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-clike"><code class="language-clike">char buf<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
int fd<span class="token punctuation">;</span>
int nbytes<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 打开文件描述符，并向其写入 512 字节的数据</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>nbytes <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>tips：x86-64 系统中，size-t 被定义为 unsigned long，而 ssize-t（有符号）被定义为 long，因为函数返回值可能为 - 1</p></blockquote><ul><li>lseek 函数<br>为一个打开的文件设置其偏移量</li></ul><pre class="line-numbers language-clike"><code class="language-clike">off_t <span class="token function">lseek</span><span class="token punctuation">(</span>int fd<span class="token punctuation">,</span> off_t offset<span class="token punctuation">,</span> int whence<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Offset：偏移量，每一读写操作所需要移动的距离，单位是字节的数量，可正可负（向前，向后）</p><p>whence: SEEK_SET / SEEK_CUR / SEEK_END (依次为 0，1，2）.</p><p>SEEK_SET 将读写位置指向文件头后再增加 offset 个位移量。</p><p>SEEK_CUR 以目前的读写位置往后增加 offset 个位移量。</p><p>SEEK_END 将读写位置指向文件尾后再增加 offset 个位移量。</p><p>当 whence 值为 SEEK_CUR 或 SEEK_END 时，参数 offet 允许负值的出现</p><p>当调用成功时则返回目前的读写位置，也就是距离文件开头多少个字节。若有错误则返回 - 1，errno 会存放错误代码</p><ul><li>元数据<br>元数据是用来描述数据的结构，由内核维护，可以通过 stat 和 fstat 函数来访问</li></ul><pre class="line-numbers language-clike"><code class="language-clike">int <span class="token function">stat</span><span class="token punctuation">(</span>const char <span class="token operator">*</span>filename<span class="token punctuation">,</span> struct stat <span class="token operator">*</span>buf<span class="token punctuation">)</span>
int <span class="token function">fstat</span><span class="token punctuation">(</span>int fd<span class="token punctuation">,</span> struct stat <span class="token operator">*</span>buf<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>函数结果是填充一个 stat 结构：</p><pre class="line-numbers language-clike"><code class="language-clike">struct stat
<span class="token punctuation">{</span>
    dev_t           st_dev<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// Device</span>
    ino_t           st_ino<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// inode</span>
    mode_t          st_mode<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Protection &amp; file type</span>
    nlink_t         st_nlink<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Number of hard links</span>
    uid_t           st_uid<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// User ID of owner</span>
    gid_t           st_gid<span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// Group ID of owner</span>
    dev_t           st_rdev<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Device type (if inode device)</span>
    off_t           st_size<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Total size, in bytes</span>
    unsigned long   st_blksize<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Blocksize for filesystem I/O</span>
    unsigned long   st_blocks<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Number of blocks allocated</span>
    time_t          st_atime<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Time of last access</span>
    time_t          st_mtime<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Time of last modification</span>
    time_t          st_ctime<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Time of last change</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-clike"><code class="language-clike">int <span class="token function">main</span> <span class="token punctuation">(</span>int argc<span class="token punctuation">,</span> char <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    struct stat stat<span class="token punctuation">;</span>
    char <span class="token operator">*</span>type<span class="token punctuation">,</span> <span class="token operator">*</span>readok<span class="token punctuation">;</span>

    <span class="token function">Stat</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>stat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">S_ISREG</span><span class="token punctuation">(</span>stat<span class="token punctuation">.</span>st_mode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 确定文件类型，S_ISREG(m) 判断普通文件，</span>
        type <span class="token operator">=</span> <span class="token string">"regular"</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">S_ISDIR</span><span class="token punctuation">(</span>stat<span class="token punctuation">.</span>st_mode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// S_ISDIR(m) 判断目录文件</span>
        type <span class="token operator">=</span> <span class="token string">"directory"</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token comment" spellcheck="true">// S_ISSOCK(m) 判断网络套接字</span>
        type <span class="token operator">=</span> <span class="token string">"other"</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>stat<span class="token punctuation">.</span>st_mode <span class="token operator">&amp;</span> S_IRUSR<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 检查读权限</span>
        readok <span class="token operator">=</span> <span class="token string">"yes"</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        readok <span class="token operator">=</span> <span class="token string">"no"</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"type: %s, read: %s\n"</span><span class="token punctuation">,</span> type<span class="token punctuation">,</span> readok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>读取目录内容</li></ul><pre class="line-numbers language-clike"><code class="language-clike">int <span class="token function">main</span><span class="token punctuation">(</span>int argc<span class="token punctuation">,</span> char <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  DIR <span class="token operator">*</span>streamp<span class="token punctuation">;</span>
  struct dirent <span class="token operator">*</span>dep<span class="token punctuation">;</span>
  streamp <span class="token operator">=</span> <span class="token function">Opendir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  errno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dep <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span>streamp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> NULL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" 找到文件：%s\n"</span><span class="token punctuation">,</span> dep <span class="token operator">-</span><span class="token operator">></span> d_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>errno <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">unix_error</span><span class="token punctuation">(</span><span class="token string">"readdir 失败 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">CloseDir</span><span class="token punctuation">(</span>streamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="标准输入输出"><a href="#标准输入输出" class="headerlink" title="标准输入输出"></a>标准输入输出</h2><p>C 标准库中包含一系列高层的标准 IO 函数</p><ul><li>打开和关闭文件: fopen, fclose</li><li>读取和写入字节: fread, fwrite</li><li>读取和写入行: fgets, fputs</li><li>格式化读取和写入: fscanf, fprintf</li></ul><p>Standard C I/O: fopen, fdopen, fread, fwrite, fscanf, fprintf, sscanf, sprintf, fgets, fputs, fflush, fseek, fclose</p><h2 id="Node-js-文件系统-fs-模块"><a href="#Node-js-文件系统-fs-模块" class="headerlink" title="Node.js 文件系统 fs 模块"></a>Node.js 文件系统 fs 模块</h2><p>Node.js 提供一组类似 UNIX（POSIX）标准的文件操作 API。 Node 导入文件系统模块 (fs) 语法如下所示</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Node.js 文件系统（fs 模块）模块中的方法均有异步和同步版本，例如读取文件内容的函数有异步的 fs.readFile() 和同步的 fs.readFileSync()。<br>异步的方法函数最后一个参数为回调函数，回调函数的第一个参数包含了错误信息 (error)。<br>建议大家是用异步方法，比起同步，异步方法性能更高，速度更快，而且没有阻塞</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 异步读取</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./hello.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 同步读取</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./hello.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>打开文件</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> flags<span class="token punctuation">[</span><span class="token punctuation">,</span> mode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// fd 是返回的文件描述符</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>获取文件信息</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// stats 是 fs.Stats 对象</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><p>stats 类</p><p>查询文件信息</p></li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一个 stats 类对象的内容</p><pre class="line-numbers language-json"><code class="language-json"><span class="token punctuation">{</span>
  dev<span class="token operator">:</span> <span class="token number">16777220</span><span class="token punctuation">,</span>   // 文件或目录所在的设备 I<span class="token punctuation">,</span> 该属性值在 UNIX 系统下有效
  mode<span class="token operator">:</span> <span class="token number">33188</span><span class="token punctuation">,</span>     // 文件或目录的权限标志，采用数值形式表示
  nlink<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        // 文件或目录的的硬连接数量
  uid<span class="token operator">:</span> <span class="token number">501</span><span class="token punctuation">,</span>        // 文件或目录的所有者的用户 ID<span class="token punctuation">,</span> 该属性值在 UNIX 系统下有效
  gid<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>         // 文件或目录的所有者的用户组 ID<span class="token punctuation">,</span> 该属性值在 UNIX 系统下有效
  rdev<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>         // 字符设备文件或块设备文件所在设备 ID<span class="token punctuation">,</span> 该属性值在 UNIX 系统下有效
  blksize<span class="token operator">:</span> <span class="token number">4096</span><span class="token punctuation">,</span>   // 块大小
  ino<span class="token operator">:</span> <span class="token number">78808297</span><span class="token punctuation">,</span>   // 文件或目录的索引编号<span class="token punctuation">,</span> 该属性值仅在 UNIX 系统下有效
  size<span class="token operator">:</span> <span class="token number">244</span><span class="token punctuation">,</span>       // 文件的字节数
  blocks<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>       // 块数
  atime<span class="token operator">:</span> Wed May <span class="token number">27</span> <span class="token number">2015</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">43</span> GMT+<span class="token number">0800</span> (CST<span class="token punctuation">)</span><span class="token punctuation">,</span>  // 文件或目录的访问时间
  mtime<span class="token operator">:</span> Wed May <span class="token number">27</span> <span class="token number">2015</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">26</span><span class="token operator">:</span><span class="token number">25</span> GMT+<span class="token number">0800</span> (CST<span class="token punctuation">)</span><span class="token punctuation">,</span>  // 文件或目录的最后修改时间
  ctime<span class="token operator">:</span> Wed May <span class="token number">27</span> <span class="token number">2015</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">26</span><span class="token operator">:</span><span class="token number">25</span> GMT+<span class="token number">0800</span> (CST<span class="token punctuation">)</span><span class="token punctuation">,</span>  // 文件或目录状态的最后修改时间
  birthtime<span class="token operator">:</span> Mon<span class="token punctuation">,</span> <span class="token number">10</span> Oct <span class="token number">2011</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">11</span> GMT<span class="token punctuation">,</span>        // 文件创建时间
  atimeMs<span class="token operator">:</span> <span class="token number">1318289051000.1</span><span class="token punctuation">,</span>      // 以单位为毫秒保存相对应时间的数字
  mtimeMs<span class="token operator">:</span> <span class="token number">1318289051000.1</span><span class="token punctuation">,</span>
  ctimeMs<span class="token operator">:</span> <span class="token number">1318289051000.1</span><span class="token punctuation">,</span>
  birthtimeMs<span class="token operator">:</span> <span class="token number">1318289051000.1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>stats 类的方法</p><ol><li>stats.isFile() 如果是标准文件，返回 true。是目录、套接字、符号连接、或设备等返回 false</li><li>stats. isDirectory() 如果是目录，返回 true</li><li>stats. isBlockDevice() 如果是块设备，返回 true，大多数情况下类 UNIX 系统的块设备都位于 / dev 目录下</li><li>stats. isCharacterDevice() 如果是字符设备，返回 true</li><li>stats. isSymbolicLink() 如果是符号连接，返回 true。（fs.lstat() 方法返回的 stats 对象才有此方法）</li><li>stats.isFIFO() 如果是 FIFO（FIFO 是 UNIX 中的一种特殊类型的命令管道），返回 true。FIFO 是 UNIX 中的一种特殊类型的命令管道</li><li>stats. isSocket() 如果是 UNIX 套接字（socket），返回 true</li></ol><ul><li>检查文件是否存在</li></ul><ol><li>fs.stat()，如果 stats 对象存在且 stats.isFile() 为 true 才能确认要修改或删除的文件存在</li></ol><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">'/xxx'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>stat <span class="token operator">&amp;&amp;</span> stat<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 文件存在 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 文件不存在或不是标准文件 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>fs.access(), 检查到指定 path 路径的目录或文件的访问权限</li></ol><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span> mode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// 检查文件是否存在</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">'/etc/passwd'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err <span class="token operator">?</span> <span class="token string">'文件存在'</span> <span class="token punctuation">:</span> <span class="token string">'文件不存在 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 检查是否对文件是否有读写权限</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">'/etc/passwd'</span><span class="token punctuation">,</span> fs<span class="token punctuation">.</span>R_OK <span class="token operator">|</span> fs<span class="token punctuation">.</span>W_OK<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err <span class="token operator">?</span> <span class="token string">'不可操作!'</span> <span class="token punctuation">:</span> <span class="token string">'可以读 / 写 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>fs.F_OK - 文件是对于进程是否可见，可以用来检查文件是否存在。也是 mode 的默认值<br>fs.R_OK - 文件对于进程是否可读<br>fs.W_OK - 文件对于进程是否可写<br>fs.X_OK - 文件对于进程是否可执行。（Windows 系统不可用，执行效果等同 fs.F_OK）</p><ul><li>写入文件</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>fd - 通过 fs.open() 方法返回的文件描述符。</li><li>buffer - 数据写入的缓冲区。</li><li>offset - 缓冲区写入的写入偏移量。</li><li>length - 要从文件中读取的字节数。</li><li>position - 文件读取的起始位置，如果 position 的值为 null，则会从当前文件指针的位置读取。</li><li>callback - 回调函数，有三个参数 err, bytesRead, buffer，err 为错误信息， bytesRead 表示读取的字节数，buffer 为缓冲区对象</li></ol><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 准备打开已存在的文件！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'input.txt'</span><span class="token punctuation">,</span> <span class="token string">'r+'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> fd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 文件打开成功！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 准备读取文件：'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bytes <span class="token operator">+</span> <span class="token string">' 字节被读取 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 仅输出读取的字节</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// fs.write(fd, buffer, offset, length[, position], callback)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>关闭文件</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>截取文件</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">ftruncate</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>删除文件</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>创建目录</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span> mode<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>读取目录</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> files<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// files 为目录下的文件数组列表</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>删除目录</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>检测给定的路径是否存在</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 异步版本已无效</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>追加文件内容</li></ul><pre class="line-numbers language-javascript"><code class="language-javascript">fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="几条查询目录信息终端命令"><a href="#几条查询目录信息终端命令" class="headerlink" title="几条查询目录信息终端命令"></a>几条查询目录信息终端命令</h2><pre class="line-numbers language-bash"><code class="language-bash">$ <span class="token function">find</span> 路径 -type f<span class="token operator">|</span><span class="token function">wc</span> -l // 统计文件数
$ <span class="token function">find</span> 路径 -type d<span class="token operator">|</span><span class="token function">wc</span> -l // 统计目录数

$ <span class="token function">du</span> -sh 路径 // 统计大小
$ <span class="token function">df</span> -h /    // 查询磁盘使用量

$ <span class="token function">ls</span> -lR 路径 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"^d"</span><span class="token operator">|</span><span class="token function">wc</span> -l // 统计目录数
$ <span class="token function">ls</span> -lR 路径 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"^-"</span><span class="token operator">|</span><span class="token function">wc</span> -l // 统计文件数
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></div><div class="copyright"><p><span>本文标题:</span><a href="/2017/08-SystemIO.html">系统 I/O</a></p><p><span>文章作者:</span><a href="/" title="回到主页">鱼乐</a></p><p><span>发布时间:</span>2017-08-05, 00:00:00</p><p><span>最后更新:</span>2018-07-29, 12:27:21</p><p><span>原始链接:</span><a class="post-url" href="/2017/08-SystemIO.html" title="系统 I/O">https://blog.wangriyu.wang/2017/08-SystemIO.html</a></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。</p></div><nav id="article-nav"><div id="article-nav-newer" class="article-nav-title"><a href="/2017/08-Storage.html">浏览器本地存储</a></div><div id="article-nav-older" class="article-nav-title"><a href="/2017/06-JSNote3.html">0611-JS 笔记</a></div></nav></article><div id="toc" class="toc-article"><strong class="toc-title">文章目录</strong><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unix-I-O-是系统底层数据操作"><span class="toc-text">Unix I/O 是系统底层数据操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#标准输入输出"><span class="toc-text">标准输入输出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-js-文件系统-fs-模块"><span class="toc-text">Node.js 文件系统 fs 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#几条查询目录信息终端命令"><span class="toc-text">几条查询目录信息终端命令</span></a></li></ol></div><style>.left-col .switch-area,.left-col .switch-btn{display:none}.toc-level-6 i,.toc-level-6 ol{display:none!important}</style><input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录"><script>yiliaConfig.toc=["隐藏目录","显示目录",!0],$(".left-col").is(":hidden")&&$("#tocButton").attr("value",yiliaConfig.toc[1])</script><div class="share"><link rel="stylesheet" type="text/css" href="/share/iconfont.css"><link rel="stylesheet" href="/share/spongebob.min.css" type="text/css" media="all"><div class="social_share"><ul id="social_list" class="social_icon_list"></ul></div><script>var shareConfig={title:"系统 I/O",url:window.location.href,author:"鱼乐",img:"https://src.wangriyu.wang/images/blog/avatar.jpg"}</script><script src="/share/qrcode.min.js"></script><script src="/share/spongebob.min.js"></script></div><section id="comments" style="margin:2em;padding:2em;background:rgba(255,255,255,.5)"><link rel="stylesheet" href="//src.wangriyu.wang/lib/gitalk/gitalk.min.css"><script src="//src.wangriyu.wang/lib/gitalk/gitalk.min.js"></script><div id="gitalk-container"></div><script type="text/javascript">var gitalk=new Gitalk({clientID:"f7029005e9b4b35463e1",clientSecret:"62c9e6339c73778f29fd10eea90ea5aeb4f15427",repo:"wangriyu.github.io",owner:"wangriyu",admin:["wangriyu"],id:window.location.pathname});gitalk.render("gitalk-container")</script></section><div class="scroll" id="post-nav-button"><a href="/2017/08-Storage.html" title="上一篇: 浏览器本地存储"><i class="fa fa-angle-left"></i> </a><a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a> <a href="/2017/06-JSNote3.html" title="下一篇: 0611-JS 笔记"><i class="fa fa-angle-right"></i></a></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08-Jenkins.html">Jenkins + Ansible 实现 Golang 自动化编译部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08-ELK.html">从零开始搭建一套日志收集分析系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08-Linux_libc.html">解决 Linux “GLIBCXX_* not found” 问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07-root.html">Mac 系统如何解锁、root、刷 Android 手机</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06-Distribution.html">分布式相关理论和分布式事务</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06-share.html">浏览器的 Copy 事件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06-Hash.html">数据结构 - 哈希</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06-Tree.html">数据结构 - 树</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06-Aplayer.html">使用 Aplayer 导致博客目录跳转失效</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05-server-nextcloud.html">搭建 docker 环境并用 docker 部署 nextcloud 网盘</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05-server-ftp.html">CentOS 搭建 FTP 服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05-HTTP2.html">HTTP2 详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05-server-git.html">博客搬家</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04-go-http.html">Golang http/server</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04-go-rpc.html">Golang RPC</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04-http-pki.html">PKI 体系</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03-http-tls.html">SSL/TLS 详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03-http-message.html">HTTP Message</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03-valine.html">更换博客评论系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01-githubpage.html">GithubPages 绑定二级域名并开启 HTTPS</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12-Dart V.html">Dart 语法入门 V</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12-MacStorageExpansion.html">极具性价比的 Mac 存储扩展方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12-Win+Ubuntu.html">UEFI + GPT + Win10 + Ubuntu + rEFInd</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12-Dart IV.html">Dart 语法入门 IV</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11-masm.html">masm for mac</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11-Dart III.html">Dart 语法入门 III</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10-Dart II.html">Dart 语法入门 II</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10-MacSkills.html">Mac 快速入门操作指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10-Dart I.html">Dart 语法入门 I</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09-ShareArtifact.html">分享自用的一些软件、插件、网站和应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08-Hexo.html">使用 Hexo 主题 Yelee</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08-Storage.html">浏览器本地存储</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08-SystemIO.html">系统 I/O</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06-JSNote3.html">0611-JS 笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05-JSNote2.html">0507-JS 笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04-JSNote1.html">0423-JS 笔记</a></li></ul><script></script></div><footer id="footer"><div class="outer"><div id="footer-info"><div class="footer-left"><i class="fa fa-copyright"></i> 2017-2018 冀-18010769-1</div><div class="visit"><span id="busuanzi_container_site_pv" style="display:none"><span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span> </span></span><span>| </span><span id="busuanzi_container_page_pv" style="display:none"><span id="page-visit" title="本页阅读量"><i class="fa fa-eye" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span></span></span></div><div class="footer-right"><a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a> Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart"></i></div></div></div></footer></div><script type="application/javascript">var hide=!1,leftWidth=312;$(".hide-left-col").click(function(){hide?($(".left-col").width(leftWidth),$(".left-col .intrude-less").fadeIn(200),$("#tocButton").fadeIn(200),"block"===$("#switch-btn").css("display")&&"block"===$("#switch-area").css("display")||$("#toc").fadeIn(200),$(".hide-left-col").css("left",leftWidth).html('<i class="fa fa-angle-double-left"></i>'),$(".mid-col").css("left",leftWidth),$("#post-nav-button").css("left",leftWidth),$("#post-nav-button > a:nth-child(2)").css("display","block"),hide=!1):($(".left-col").width(0),$(".left-col .intrude-less").fadeOut(200),$("#toc").fadeOut(100),$("#tocButton").fadeOut(100),$(".hide-left-col").css("left",0).html('<i class="fa fa-angle-double-right"></i>'),$(".mid-col").css("left",0),$("#post-nav-button").css("left",0),$("#post-nav-button > a:nth-child(2)").css("display","none"),$(".post-list").is(":visible")&&($("#post-nav-button .fa-bars,#post-nav-button .fa-times").toggle(),$(".post-list").toggle()),hide=!0)})</script><script data-main="/js/main.js" src="//src.wangriyu.wang/lib/requirejs/require.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax:{inlineMath:[["$$","$$"],["$","$"],["\\(","\\)"]],processEscapes:!0,skipTags:["script","noscript","style","textarea","pre","code"]}}),MathJax.Hub.Queue(function(){var a,e=MathJax.Hub.getAllJax();for(a=0;a<e.length;a+=1)e[a].SourceElement().parentNode.className+=" has-jax"})</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" async></script><div class="scroll" id="scroll"><a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a> <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a> <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a></div><script>var oOpenInNew={post:".copyright a[href]",friends:"#js-friends a",socail:".social a"};for(var x in oOpenInNew)$(oOpenInNew[x]).attr("target","_blank")</script><script>var titleTime,originTitle=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="(つェ⊂)"+originTitle,clearTimeout(titleTime)):(document.title="(*´∇｀*)~ "+originTitle,titleTime=setTimeout(function(){document.title=originTitle},2e3))})</script><script async src="https://src.wangriyu.wang/lib/busuanzi/busuanzi.pure.mini.js"></script></div><link href="//src.wangriyu.wang/lib/aos/aos.css" rel="stylesheet"><script type="text/javascript">AOS.init({easing:"ease-out-back",once:!0})</script><script>!function(l){var o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function n(){for(var t=0,e=o.length;t<e;t++)n=o[t],void 0,0<=(i=n.getBoundingClientRect()).top&&0<=i.left&&i.top<=(l.innerHeight||document.documentElement.clientHeight)&&(o[t].src=o[t].getAttribute("data-original"),o.splice(t,1),e=o.length);var n,i}n(),l.addEventListener("scroll",function(){var t,e;t=n,e=l,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)},!1)}(this);</script></body>